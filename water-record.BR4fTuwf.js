var e,t=Object.defineProperty,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,n=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&s(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&s(e,n,t[n]);return e},i=(e,t,a)=>new Promise(((r,o)=>{var s=e=>{try{i(a.next(e))}catch(t){o(t)}},n=e=>{try{i(a.throw(e))}catch(t){o(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,n);i((a=a.apply(e,t)).next())}));import{p as c,q as l,u,v as d,x as v,y as g,z as m,r as h,c as y}from"./index-C5owvC0d.js";class p{static set(e,t){const a="string"==typeof t?t:JSON.stringify(t);c(e,a)}static get(e){const t=l(e);if(!t)return null;try{return JSON.parse(t)}catch(a){return t}}static remove(e){u(e)}static clear(){d()}static setToken(e){this.set("access_token",e)}static getToken(){return this.get("access_token")}static removeToken(){this.remove("access_token")}static setUserSettings(e){this.set("user_settings",e)}static getUserSettings(){return this.get("user_settings")||{}}}class w{static getAuthHeader(){const e=p.get("access_token");return e?{Authorization:`Bearer ${e}`}:{}}static request(e){return i(this,null,(function*(){const{url:t,method:a="GET",data:r,header:o={}}=e;return new Promise(((e,s)=>{v({url:this.baseURL+t,method:a,data:r,header:n(n({"Content-Type":"application/json"},this.getAuthHeader()),o),success:t=>{var a;200===t.statusCode?e(t.data):401===t.statusCode?(p.remove("access_token"),g({url:"/pages/index/index"}),s(new Error("Unauthorized"))):s(new Error((null==(a=t.data)?void 0:a.message)||"Request failed"))},fail:e=>{s(e)}})}))}))}static get(e,t){return this.request({url:e,data:t})}static post(e,t){return this.request({url:e,method:"POST",data:t})}static put(e,t){return this.request({url:e,method:"PUT",data:t})}static delete(e){return this.request({url:e,method:"DELETE"})}}s(w,"symbol"!=typeof(e="baseURL")?e+"":e,"https://api.example.com");const f=m("waterRecord",(()=>{const e=h([]),t=h(0),a=h(2e3),r=h(!1),o=y((()=>{const t=(new Date).toDateString();return e.value.filter((e=>new Date(e.recordTime).toDateString()===t))})),s=y((()=>Math.min(t.value/a.value*100,100))),n=y((()=>Math.max(a.value-t.value,0))),c=t=>i(void 0,null,(function*(){try{yield w.post("/api/water-records",t);const a=e.value.findIndex((e=>e.id===t.id));-1!==a&&(e.value[a].isSynced=!0),l()}catch(a){}})),l=()=>{p.set("water_records",e.value),p.set("today_total",t.value),p.set("daily_goal",a.value)},u=()=>{const e=p.get("last_record_date"),a=(new Date).toDateString();e!==a&&(t.value=0,p.set("today_total",0),p.set("last_record_date",a))},d=()=>{const a=(new Date).toDateString(),r=e.value.filter((e=>new Date(e.recordTime).toDateString()===a));t.value=r.reduce(((e,t)=>e+t.amount),0)};return{records:e,todayTotal:t,dailyGoal:a,loading:r,todayRecords:o,progress:s,remaining:n,addRecord:(a,r="water")=>i(void 0,null,(function*(){const o={id:`record_${Date.now()}`,userId:"current_user",amount:a,recordType:r,recordTime:(new Date).toISOString(),isSynced:!1,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return e.value.unshift(o),t.value+=a,l(),c(o),o})),deleteRecord:a=>i(void 0,null,(function*(){const r=e.value.findIndex((e=>e.id===a));if(-1!==r){const s=e.value[r].amount;e.value.splice(r,1),t.value=Math.max(t.value-s,0),l();try{yield w.delete(`/api/water-records/${a}`)}catch(o){}}})),setDailyGoal:e=>{a.value=e,l()},loadFromLocal:()=>{const r=p.get("water_records")||[],o=p.get("today_total")||0,s=p.get("daily_goal")||2e3;e.value=r,t.value=o,a.value=s,u()},loadFromServer:()=>i(void 0,null,(function*(){r.value=!0;try{const t=yield w.get("/api/water-records",{limit:100});e.value=t.records||[],d(),l()}catch(t){}finally{r.value=!1}})),getWeeklyStats:()=>{const t=new Date,a=new Date(t.getTime()-6048e5),r=e.value.filter((e=>{const r=new Date(e.recordTime);return r>=a&&r<=t})),o={};for(let e=0;e<7;e++){const a=new Date(t.getTime()-24*e*60*60*1e3).toDateString();o[a]=0}return r.forEach((e=>{const t=new Date(e.recordTime).toDateString();void 0!==o[t]&&(o[t]+=e.amount)})),o},getMonthlyStats:()=>{const t=new Date,a=new Date(t.getTime()-2592e6),r=e.value.filter((e=>{const r=new Date(e.recordTime);return r>=a&&r<=t})),o=r.reduce(((e,t)=>e+t.amount),0),s=o/30;return{total:o,avg:Math.round(s),count:r.length}}}}));export{f as u};
